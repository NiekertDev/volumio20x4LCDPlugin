#!/bin/bash

echo "Installing LCDcontroller Dependencies"
sudo apt-get update
# Install the required packages via apt-get
# The 'base64'-command is already a thing in volumio
sudo apt-get -y install python-mpd python-smbus

# From now on, the code is a bit ugly.
# All files are stored inside this one, base64 encoded
# Then they get un-base64'd and stored, so volumio can use them

sudo mkdir /opt/LCDcontroller

# Store scrollText.py
echo "Extracting main LCD controller"
SCROLLTEXT=IyEgL3Vzci9iaW4vZW52IHB5dGhvbgojIEltcG9ydCBzZXR0aW5ncy5weQppbXBvcnQgc2V0dGluZ3MKIyBpbXBvcnQgdGhlIHJlc3QKZnJvbSBvcyBpbXBvcnQgKgpmcm9tIHRpbWUgaW1wb3J0ICoKZnJvbSBzeXMgaW1wb3J0ICoKZnJvbSBtYXRoIGltcG9ydCAqCmZyb20gbXBkIGltcG9ydCBNUERDbGllbnQKCm1wZF9ob3N0ID0gc2V0dGluZ3MuZ2V0SG9zdElQKCkKbXBkX3BvcnQgPSAiNjYwMCIKbXBkX3Bhc3N3b3JkID0gInZvbHVtaW8iCgpjbGllbnQgPSBNUERDbGllbnQoKQpjbGllbnQuY29ubmVjdChtcGRfaG9zdCwgbXBkX3BvcnQpCgojaW1wb3J0IGxjZC1yZWxhdGVkIHB5dGhvbiBsaWJzCmZyb20gbGNkX2Rpc3BsYXkgaW1wb3J0IGxjZAoKI21ha2Ugc3VyZSBweXRob24ga25vd3Mgd2hhdCBhbiBsY2QgaXMKbXlfbGNkID0gbGNkKCkKCiNtYWtlIGxjZC1wb3NpdGlvbnMganVzdCB3b3JrIHByb3Blcmx5CmxjZF9wb3NpdGlvbj1bMSwzLDIsNF0KCiNkZWZpbmUgc29tZSBvcHRpb25zCm1vdmVUZXh0ID0gMSAjRm9yIHN0YWJpbGl0eSwgVGhpcyBzaG91bGQgYmUgcmVtYWluIDEuIFRoaXMgc2NyaXB0IGNhbiBoYW5kbGUgPj0gMiB0aG91Z2gsIGJ1dCBpdCB3aWxsIGxvb2sgYSBiaXQgd2VpcmQgYXMgaXQgaXMgcmlnaHQgbm93LiBETyBOT1QgRkVFRCBUSElTIEEgRkxPQVQgTlVNQkVSIQppbmZvUmVmcmVzaFRpbWVXYWl0ID0gMC4yCnRpbWVXYWl0VGltZVN0YW1wID0gMAppbmZvUmVmcmVzaFRpbWVTdGFtcCA9IHRpbWUoKQp0aW1lV2FpdCA9IDEgIyBBbW91bnQgb2YgdGltZSB0byB3YWl0IGJlZm9yZSBtb3ZpbmcgYSBwaWVjZSBvZiB0ZXh0IG9uIHRoZSBsY2QKbGluZVRpbWVXYWl0ID0gMCAgIyBTZXQgdG8gMCwgdW5sZXNzIHRoZSBtb3ZpbmcgdGV4dCBzaG91bGQgd2FpdCBleHRyYSBsb25nIGJlZm9yZSBzY3JvbGxpbmcKCiNtYWtpbmcgc3VyZSBpdCBkb2Vzbid0IHRocm93IGVycm9ycwpzb25nSW5mbz1bJyAnLCAnICcsICcgJywnICddCnRleHRPbmUgPSAnICcKdGV4dFR3byA9ICcgJwp0ZXh0VGhyZWUgPSAnICcKdGV4dEZvdXIgPSAnICcKCmRlZiBzZW5kVG9MQ0QobGluZU51bSwgdGV4dFRvRGlzcGxheSk6ICNUaGlzIGZ1bmN0aW9uIHdpbGwgc2VuZCBhIHN0cmluZyB0byB0aGUgTENEIHNjcmVlbgoJI3ByaW50KCdTZW5kIHRvIExDRCBsaW5lICcgKyBzdHIobGluZU51bSkgKyAnOiAiJyArIHN0cih0ZXh0VG9EaXNwbGF5KSArICciJykgICNERUJVRyAoV2lsbCBub3QgcHJpbnQgdG8gTENEIGJ1dCB0byB0aGUgU1NILXNoZWxsISkKICAgICAgICAjIFRPRE86IFVuaWNvZGUgc3VwcG9ydC9kaXNyZWdhcmQuIElmIHVuaWNvZGUgY2hhcnMgYXJlIGZvdW5kLCB3aGF0IHRvIGRvPyBEb250IHNlbmQgdGhlIHN0cmluZz8gVHJ5IHRvIHNlbmQgdGhlbSBhbnl3YXk/IFNlbmQgJz8/Pz8/Pz8/Pz8/Pyc/CiAgICAgICAgbXlfbGNkLmRpc3BsYXlfc3RyaW5nKHRleHRUb0Rpc3BsYXksIGxjZF9wb3NpdGlvbltsaW5lTnVtXSkKICAgICAgICAjcHJpbnQoc3RyKGxpbmVOdW0pICsgJzogJyArIHN0cih0ZXh0VG9EaXNwbGF5KSkgI0RFQlVHIQoKd2VsY29tZVRpbWVzdGFtcCA9IHRpbWUoKQp3ZWxjb21lVGltZSA9IHNldHRpbmdzLmdldFdlbGNvbWVNZXNzYWdlRHVyYXRpb24oKQp3ZWxjb21lTWVzc2FnZSA9IHNldHRpbmdzLmdldFdlbGNvbWVNZXNzYWdlKCkKIyBTaG93IHdlbGNvbWUgbWVzc2FnZQpzZW5kVG9MQ0QoMCwgd2VsY29tZU1lc3NhZ2VbJ0xpbmUxJ10pCnNlbmRUb0xDRCgxLCB3ZWxjb21lTWVzc2FnZVsnTGluZTInXSkKc2VuZFRvTENEKDIsIHdlbGNvbWVNZXNzYWdlWydMaW5lMyddKQpzZW5kVG9MQ0QoMywgd2VsY29tZU1lc3NhZ2VbJ0xpbmU0J10pCnNsZWVwKHdlbGNvbWVUaW1lKQoKZGVmIHVwZGF0ZUxDRGluZm8oKToKCXJldHVybkRhdGEgPSBbJyAnLCAnICcsICcgJywgJyAnXQoJY3VycmVudFNvbmcgPSBjbGllbnQuY3VycmVudHNvbmcoKQoJc3RhdHVzID0gY2xpZW50LnN0YXR1cygpCglpZihzdGF0dXNbJ3N0YXRlJ10gIT0gJ3N0b3AnKToKCQlpZihzdHIoY3VycmVudFNvbmcpICE9ICd7fScpOgoJCQlpZignZmlsZScgaW4gc3RyKGN1cnJlbnRTb25nKSk6CgkJCQlzb3VyY2UgPSBjdXJyZW50U29uZ1snZmlsZSddCgkJCQlpZiAnaHR0cCcgaW4gY3VycmVudFNvbmdbJ2ZpbGUnXTogI0NoZWNrIGZvciBhbnkgd2Vic3RyZWFtcyBiZWZvcmUgcmV0dXJuaW5nIGluZm9ybWF0aW9uCgkJCQkJI0l0J3MgYSByYWRpby1zdHJlYW0gZnJvbSB0aGUgaW50ZXJ3ZWJzISBQZWZvcm0gc29tZSBtYWdpYyBvbiB0aGUgdGl0bGUsIGJlY2F1c2UgaXQgYWxzbyBjb250YWlucyB0aGUgYXJ0aXN0J3MgbmFtZQoJCQkJCXJhZGlvTmFtZSA9ICcgJwoJCQkJCWV4dHJhSW5mbyA9ICcgJwoJCQkJCWV4dHJhSW5mb0ZvdW5kID0gRmFsc2UKCQkJCQlpZignbmFtZScgaW4gc3RyKGN1cnJlbnRTb25nKSk6CgkJCQkJCXJhZGlvTmFtZSA9IGN1cnJlbnRTb25nWyduYW1lJ10KCQkJCQlpZigndGl0bGUnIGluIHN0cihjdXJyZW50U29uZykpOgoJCQkJCQl0aXRsZSA9IGN1cnJlbnRTb25nWyd0aXRsZSddCgkJCQkJZWxzZToKCQkJCQkJdGl0bGUgPSAnICcKCQkJCQlpZiAnIC0gJyBpbiB0aXRsZSBvciAnIDogJyBpbiB0aXRsZToKCQkJCQkJdGl0bGVTcGxpdCA9IHRpdGxlLnJlcGxhY2UoJyA6ICcsICcgLSAnKS5zcGxpdCgnIC0gJykKCQkJCQkJdGl0bGUgPSB0aXRsZVNwbGl0WzBdCgkJCQkJCWFydGlzdCA9IHRpdGxlU3BsaXRbMV0KCQkJCQkJaWYobGVuKHRpdGxlU3BsaXQpID49IDMpOgoJCQkJCQkJZXh0cmFJbmZvID0gdGl0bGVTcGxpdFsyXQoJCQkJCQkJZXh0cmFJbmZvRm91bmQgPSBUcnVlCgkJCQkJCWlmKGFydGlzdFswOjFdID09ICcgJyk6ICAjIHNwbGl0KCkgZG9lcyBpdCdzIGpvYiBjb3JyZWN0bHksIGJ1dCBJIGRvbid0IHdhbnQgYSA8c3BhY2U+IGF0IHRoZSBiZWdpbm5pbmcgb2YgaW5mb3JtYXRpb25zCgkJCQkJCQlhcnRpc3QgPSBhcnRpc3RbMTo6XSAgIyBTbyBpbmZvPWluZm8tZmlyc3RfY2hhcgoJCQkJCQlpZih0aXRsZVstMV0gPT0gJyAnKToKCQkJCQkJCXRpdGxlID0gdGl0bGVbOi0xXQoJCQkJCQlpZihleHRyYUluZm9Gb3VuZCA9PSBGYWxzZSk6CgkJCQkJCQlyZXR1cm5EYXRhID0gW3RpdGxlLCBhcnRpc3QsIHJhZGlvTmFtZSwgJyAnXQoJCQkJCQllbHNlOgoJCQkJCQkJcmV0dXJuRGF0YSA9IFt0aXRsZSwgYXJ0aXN0LCBleHRyYUluZm8sIHJhZGlvTmFtZV0KCQkJCQllbHNlOgoJCQkJCQlyZXR1cm5EYXRhID0gW3RpdGxlLCByYWRpb05hbWUsICcgJywgJyAnXQoJCQkJZWxzZToKCQkJCQkjSXQncyBub3QgcGxheWluZyBhIHdlYi1zdHJlYW0sIGJ1dCBhIG11c2ljIGZpbGUKCQkJCQkjIEFsd2F5cyBzaG93IHRhZ3MgZmlyc3QsIHRoZW4gZmlsZW5hbWVzCgkJCQkJYXJ0aXN0Rm91bmRCeVNwbGl0dGluZ0ZpbGVuYW1lID0gRmFsc2UKCQkJCQlleHRyYUluZm8gPSAnICcKCQkJCQlleHRyYUluZm9Gb3VuZCA9IEZhbHNlCgkJCQkJYWxidW1Gb3VuZCA9IEZhbHNlCgkJCQkJaWYgJ3RpdGxlJyBpbiBzdHIoY3VycmVudFNvbmcpOgoJCQkJCQl0aXRsZSA9IGN1cnJlbnRTb25nWyd0aXRsZSddCgkJCQkJZWxzZToKCQkJCQkJdGl0bGUgPSBjdXJyZW50U29uZ1snZmlsZSddCgkJCQkJCSNEbyBub3QgaW5jbHVkZSAubXAzLCAud21hLCAuZmxhYyBldGMgaW4gdGhlIHNvbmcncyBuYW1lCgkJCQkJCWlmKHN0cih0aXRsZVstNF0pID09ICcuJyk6CgkJCQkJCQl0aXRsZSA9IHRpdGxlWzA6LTRdCgkJCQkJCWVsaWYoc3RyKHRpdGxlWy01XSkgPT0gJy4nKToKCQkJCQkJCXRpdGxlID0gdGl0bGVbMDotNV0KCQkJCQkJd2hpbGUoJ1VTQi8nIGluIHRpdGxlKToKCQkJCQkJCXRpdGxlID0gdGl0bGVbNDo6XSAjIFJlbW92ZSBhbGwgdGhlICcvVVNCJyBmcm9tIHRoZSBmaWxlbmFtZSdzIHBhdGgKCQkJCQkJd2hpbGUoJ0lOVEVSTkFMLycgaW4gdGl0bGUpOgoJCQkJCQkJdGl0bGUgPSB0aXRsZVs5OjpdICMgUmVtb3ZlIGFsbCB0aGUgJy9JTlRFUk5BTCcgZnJvbSB0aGUgZmlsZW5hbWUncyBwYXRoCgkJCQkJCWlmICcgLSAnIGluIHRpdGxlIG9yICcgOiAnIGluIHRpdGxlOgoJCQkJCQkJdGl0bGVTcGxpdCA9IHRpdGxlLnJlcGxhY2UoJyA6ICcsICcgLSAnKS5zcGxpdCgnIC0gJykKCQkJCQkJCXRpdGxlID0gdGl0bGVTcGxpdFswXQoJCQkJCQkJYXJ0aXN0ID0gdGl0bGVTcGxpdFsxXQoJCQkJCQkJI1JlbW92ZSBhbGwgc3BhY2VzIGJlZm9yZSBhbmQgYWZ0ZXIgdGhlIHRpdGxlIGFydGlzdCB0ZXh0CgkJCQkJCQlpZih0aXRsZVswXSA9PSAnICcpOgoJCQkJCQkJCXRpdGxlID0gdGl0bGVbMTo6XQoJCQkJCQkJZWxpZih0aXRsZVstMV0gPT0gJyAnKToKCQkJCQkJCQl0aXRsZSA9IHRpdGxlWzotMV0KCQkJCQkJCWlmKGFydGlzdFswXSA9PSAnICcpOgoJCQkJCQkJCWFydGlzdCA9IGFydGlzdFsxOjpdCgkJCQkJCQllbGlmKGFydGlzdFstMV0gPT0gJyAnKToKCQkJCQkJCQlhcnRpc3QgPSBhcnRpc3RbOi0xXQoJCQkJCQkJI1dlIGFscmVhZHkgZm91bmQgdGhlIGFydGlzdCwgc3RvcCBsb29raW5nIGZvciB0YWdzIHBsZWFzZQoJCQkJCQkJaWYoYXJ0aXN0ICE9ICcnIG9yIGFydGlzdCAhPSAnICcpOgoJCQkJCQkJCWFydGlzdEZvdW5kQnlTcGxpdHRpbmdGaWxlbmFtZSA9IFRydWUKCQkJCQkJCWlmKGFydGlzdFswOjFdID09ICcgJyk6ICAjIHNwbGl0KCkgZG9lcyBpdCdzIGpvYiBjb3JyZWN0bHksIGJ1dCBJIGRvbid0IHdhbnQgYSA8c3BhY2U+IGF0IHRoZSBiZWdpbm5pbmcgb2YgaW5mb3JtYXRpb25zCgkJCQkJCQkJYXJ0aXN0ID0gYXJ0aXN0WzE6Ol0gICMgU28gaW5mbz1pbmZvLWZpcnN0X2NoYXIKCQkJCQkJCWlmKHRpdGxlWy0xXSA9PSAnICcpOgoJCQkJCQkJCXRpdGxlID0gdGl0bGVbOi0xXQoJCQkJCQkJI0xvb2sgZm9yIG1vcmUgaW5mbyB0aGF0IG1pZ2h0IGJlIHVzZWZ1bCB0byBwZW9wbGUuIChzb21lIGZpbGVuYW1lcyBjYW4gYmUgJzAxIC0gdGl0bGUgLSBhcnRpc3QubXAzJy4gVGhleSBzaG91bGQgYmUgaGFuZGxlZCBwcm9wZXJseSkKCQkJCQkJCWlmKGxlbih0aXRsZVNwbGl0KSA+PSAzKToKCQkJCQkJCQlleHRyYUluZm8gPSB0aXRsZVNwbGl0WzJdCgkJCQkJCQkJZXh0cmFJbmZvRm91bmQgPSBUcnVlCgkJCQkJIyBDaGVjayBpZiB0aGUgZmlsZSBjb250YWlucyBhbiBhcnRpc3QtbmFtZQoJCQkJCWlmICdhbGJ1bWFydGlzdCcgaW4gc3RyKGN1cnJlbnRTb25nKSBhbmQgYXJ0aXN0Rm91bmRCeVNwbGl0dGluZ0ZpbGVuYW1lID09IEZhbHNlOgoJCQkJCQlhcnRpc3QgPSBjdXJyZW50U29uZ1snYWxidW1hcnRpc3QnXQoJCQkJCWVsaWYoYXJ0aXN0Rm91bmRCeVNwbGl0dGluZ0ZpbGVuYW1lID09IEZhbHNlKToKCQkJCQkJYXJ0aXN0ID0gJyAnCgkJCQkJIyBDaGVjayBpZiB0aGUgZmlsZSBjb250YWlucyBhbiBhbGJ1bS1uYW1lCgkJCQkJaWYgJ2FsYnVtJyBpbiBzdHIoY3VycmVudFNvbmcpOgoJCQkJCQlhbGJ1bSA9IGN1cnJlbnRTb25nWydhbGJ1bSddCgkJCQkJCWFsYnVtRm91bmQgPSBUcnVlCgkJCQkJZWxzZToKCQkJCQkJYWxidW0gPSAnICcKCQkJCQltLCBzID0gZGl2bW9kKGZsb2F0KHN0YXR1c1snZWxhcHNlZCddKSwgNjApCgkJCQkJaCwgbSA9IGRpdm1vZChtLCA2MCkKCQkJCQllbGFwc2VkVGltZSA9ICIlZDolMDJkOiUwMmQiICUgKGgsIG0sIHMpCgkJCQkJaWYoc3RhdHVzWydzdGF0ZSddID09ICdwYXVzZScpOgoJCQkJCQllbGFwc2VkVGltZSA9ICIgICAiICsgc3RyKGVsYXBzZWRUaW1lKSArICIgfHwiCgkJCQkJaWYoYWxidW1Gb3VuZCA9PSBUcnVlIGFuZCBleHRyYUluZm9Gb3VuZCA9PSBGYWxzZSk6CgkJCQkJCXJldHVybkRhdGEgPSBbdGl0bGUsIGFydGlzdCwgYWxidW0sIHN0cihlbGFwc2VkVGltZSldCgkJCQkJZWxzZToKCQkJCQkJcmV0dXJuRGF0YSA9IFt0aXRsZSwgYXJ0aXN0LCBleHRyYUluZm8sIHN0cihlbGFwc2VkVGltZSldCgkJCWVsc2U6CgkJCQlyZXR1cm5EYXRhID0gWycgJywgJyAnLCAnICcsICcgJ10KCQllbHNlOgoJCQkjIFRoZXJlIGlzIG5vIGluZm8gdG8gZGlzcGxheSwgc2VuZCB2b2lkcwoJCQlyZXR1cm5EYXRhID0gWycgJywnICcsJyAnLCcgJ10KCWVsc2U6CgkJIyBTZW5kIHZvaWRzIHRvIHRoZSBkaXNwbGF5LCBhcyBub3RoaW5nIGlzIHBsYXlpbmcgYXQgdGhlIG1vbWVudAoJCXJldHVybkRhdGEgPSBbJyAnLCAnICcsICcgJywgJyAnXQoJcmV0dXJuIHJldHVybkRhdGEKCnRyeToKCQoJcmVzdGFydExpbmVPbmUgPSB0aW1lKCktMQoJcmVzdGFydExpbmVUd28gPSB0aW1lKCktMQoJcmVzdGFydExpbmVUaHJlZSA9IHRpbWUoKS0xCglyZXN0YXJ0TGluZUZvdXIgPSB0aW1lKCktMQoKCXBvc0xpbmVPbmU9MAoJcG9zTGluZVR3bz0wCglwb3NMaW5lVGhyZWU9MAoJcG9zTGluZUZvdXI9MAoKCXRleHRMaW5lT25lID0gICB0ZXh0T25lICsgIiB8ICIgKyB0ZXh0T25lWzA6MjBdCgl0ZXh0TGluZVR3byA9ICAgdGV4dFR3byArICIgfCAiICsgdGV4dFR3b1swOjIwXQoJdGV4dExpbmVUaHJlZSA9IHRleHRUaHJlZSArICIgfCAiICsgdGV4dFRocmVlWzA6MjBdCgl0ZXh0TGluZUZvdXIgPSAgdGV4dEZvdXIgKyAiIHwgIiArIHRleHRGb3VyWzA6MjBdCgkKCXdyaXRlTGluZU9uZSA9IEZhbHNlCgl3cml0ZUxpbmVUd28gPSBGYWxzZQoJd3JpdGVMaW5lVGhyZWUgPSBGYWxzZQoJd3JpdGVMaW5lRm91ciA9IEZhbHNlCgoJbGluZU9uZUNoYW5nZWQgPSBUcnVlCglsaW5lVHdvQ2hhbmdlZCA9IFRydWUKCWxpbmVUaHJlZUNoYW5nZWQgPSBUcnVlCglsaW5lRm91ckNoYW5nZWQgPSBUcnVlCgkJCglsYXN0UHJpbnRlZFRleHRMaW5lT25lID0gMAoJbGFzdFByaW50ZWRUZXh0TGluZVR3byA9IDAKCWxhc3RQcmludGVkVGV4dExpbmVUaHJlZSA9IDAKCWxhc3RQcmludGVkVGV4dExpbmVGb3VyID0gMAoKCXRvUHJpbnRUZXh0TGluZU9uZSA9IDAKCXRvUHJpbnRUZXh0TGluZVR3byA9IDAKCXRvUHJpbnRUZXh0TGluZVRocmVlID0gMAoJdG9QcmludFRleHRMaW5lRm91ciA9IDAKCgl3aGlsZShUcnVlKToKCQlpZih0aW1lKCktaW5mb1JlZnJlc2hUaW1lU3RhbXAgPj0gc2V0dGluZ3MuZ2V0SW5mb1JlZnJlc2hJbnRlcnZhbCgpKToKCQkJIyBJdCdzIHRpbWUgdG8gdXBkYXRlIHRoZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc29uZ3MgYW5kIHN1Y2gKCQkJc29uZ0luZm8gPSB1cGRhdGVMQ0RpbmZvKCkKCQkJdGV4dE9uZSA9IHNvbmdJbmZvWzBdCgkJCXRleHRUd28gPSBzb25nSW5mb1sxXQoJCQl0ZXh0VGhyZWUgPSBzb25nSW5mb1syXQoJCQl0ZXh0Rm91ciA9IHNvbmdJbmZvWzNdCgoJCQluZXdUZXh0TGluZU9uZSA9ICAgdGV4dE9uZSArICIgfCAiICsgdGV4dE9uZVswOjIwXQoJCQluZXdUZXh0TGluZVR3byA9ICAgdGV4dFR3byArICIgfCAiICsgdGV4dFR3b1swOjIwXQoJCQluZXdUZXh0TGluZVRocmVlID0gdGV4dFRocmVlICsgIiB8ICIgKyB0ZXh0VGhyZWVbMDoyMF0KCQkJbmV3VGV4dExpbmVGb3VyID0gIHRleHRGb3VyICsgIiB8ICIgKyB0ZXh0Rm91clswOjIwXQoJCQkjTm93IGNoZWNrIGZvciBhbnkgY2hhbmdlcwoJCQlpZih0ZXh0TGluZU9uZSAhPSBuZXdUZXh0TGluZU9uZSk6CgkJCQkjIFVwZGF0ZSB0aGUgdGV4dCwgYmVjYXVzZSB0aGVyZSBpcyBuZXcgdGV4dAoJCQkJdGV4dExpbmVPbmUgPSBuZXdUZXh0TGluZU9uZQoJCQkJIyBOb3cgcmVzZXQgc29tZSBpbnQncyBhbmQgYm9vbCdzIHRvIG1ha2UgdGhlIHRleHQgc3RhcnQgc2NvbGxpbmcgZnJvbSB0aGUgYmVnaW5uaW5nCgkJCQlwb3NMaW5lT25lID0gMAoJCQkJbGluZU9uZUNoYW5nZWQgPSBUcnVlCgkJCQl3cml0ZUxpbmVPbmUgPSBUcnVlCgkJCQluZXdUZXh0TGluZU9uZSA9IFRydWUKCQkJaWYodGV4dExpbmVUd28gIT0gbmV3VGV4dExpbmVUd28pOgoJCQkJIyBVcGRhdGUgdGhlIHRleHQsIGJlY2F1c2UgdGhlcmUgaXMgbmV3IHRleHQKCQkJCXRleHRMaW5lVHdvID0gbmV3VGV4dExpbmVUd28KCQkJCSMgTm93IHJlc2V0IHNvbWUgaW50J3MgYW5kIGJvb2wncyB0byBtYWtlIHRoZSB0ZXh0IHN0YXJ0IHNjb2xsaW5nIGZyb20gdGhlIGJlZ2lubmluZwoJCQkJcG9zTGluZVR3byA9IDAKCQkJCWxpbmVUd29DaGFuZ2VkID0gVHJ1ZQoJCQkJd3JpdGVMaW5lVHdvID0gVHJ1ZQoJCQkJbmV3VGV4dExpbmVUd28gPSBUcnVlCgkJCWlmKHRleHRMaW5lVGhyZWUgIT0gbmV3VGV4dExpbmVUaHJlZSk6CgkJCQkjIFVwZGF0ZSB0aGUgdGV4dCwgYmVjYXVzZSB0aGVyZSBpcyBuZXcgdGV4dAoJCQkJdGV4dExpbmVUaHJlZSA9IG5ld1RleHRMaW5lVGhyZWUKCQkJCSMgTm93IHJlc2V0IHNvbWUgaW50J3MgYW5kIGJvb2wncyB0byBtYWtlIHRoZSB0ZXh0IHN0YXJ0IHNjb2xsaW5nIGZyb20gdGhlIGJlZ2lubmluZwoJCQkJcG9zTGluZVRocmVlID0gMAoJCQkJbGluZVRocmVlQ2hhbmdlZCA9IFRydWUKCQkJCXdyaXRlTGluZVRocmVlID0gVHJ1ZQoJCQkJbmV3VGV4dExpbmVUaHJlZSA9IFRydWUKCQkJaWYodGV4dExpbmVGb3VyICE9IG5ld1RleHRMaW5lRm91cik6CgkJCQkjIFVwZGF0ZSB0aGUgdGV4dCwgYmVjYXVzZSB0aGVyZSBpcyBuZXcgdGV4dAoJCQkJdGV4dExpbmVGb3VyID0gbmV3VGV4dExpbmVGb3VyCgkJCQkjIE5vdyByZXNldCBzb21lIGludCdzIGFuZCBib29sJ3MgdG8gbWFrZSB0aGUgdGV4dCBzdGFydCBzY29sbGluZyBmcm9tIHRoZSBiZWdpbm5pbmcKCQkJCXBvc0xpbmVGb3VyID0gMAoJCQkJbGluZUZvdXJDaGFuZ2VkID0gVHJ1ZQoJCQkJd3JpdGVMaW5lRm91ciA9IFRydWUKCQkJCW5ld1RleHRMaW5lRm91ciA9IFRydWUKCQkJIyBTZXQgYSBuZXcgdGltZSB0byBjaGVjayBmb3IgY2hhbmdlcyBpbiB0ZXh0CgkJCWluZm9SZWZyZXNoVGltZVN0YW1wID0gdGltZSgpCgoJCWlmKHRpbWUoKS10aW1lV2FpdFRpbWVTdGFtcCA+PSB0aW1lV2FpdCk6CgkJCSMgTGluZSBvbmUgY29kZSBzdGFydHMgaGVyZQoJCQlpZihsZW4odGV4dE9uZSkgPiAyMCk6CgkJCQlpZih0aW1lKCktcmVzdGFydExpbmVPbmUgPiBsaW5lVGltZVdhaXQpOgoJCQkJCXdyaXRlTGluZU9uZSA9IFRydWUKCQkJCQl0b1ByaW50VGV4dExpbmVPbmUgPSB0ZXh0TGluZU9uZVtwb3NMaW5lT25lOnBvc0xpbmVPbmUrMjBdCgkJCQkJbGFzdFByaW50ZWRUZXh0TGluZU9uZSA9IHRleHRMaW5lT25lW3Bvc0xpbmVPbmU6cG9zTGluZU9uZSsyMF0KCQkJCQlwb3NMaW5lT25lID0gcG9zTGluZU9uZSArIG1vdmVUZXh0CgkJCQkJbGluZU9uZUNoYW5nZWQgPSBUcnVlCgkJCQkJaWYocG9zTGluZU9uZSA+PSBsZW4odGV4dExpbmVPbmUpLTE4KToKCQkJCQkJcG9zTGluZU9uZSA9IDEKCQkJCQkJcmVzdGFydExpbmVPbmUgPSB0aW1lKCkKCQkJCQkJbGluZU9uZUNoYW5nZWQgPSBGYWxzZQoJCQkJCXRpbWVTdGFtcExpbmVPbmUgPSB0aW1lKCkKCQkJZWxzZToKCQkJCXRvUHJpbnRUZXh0TGluZU9uZSA9IHRleHRPbmUKCQkJCXdyaXRlTGluZU9uZSA9IFRydWUKCQkJCgkJCSMgTGluZSB0d28gY29kZSBzdGFydHMgaGVyZQoJCQlpZihsZW4odGV4dFR3bykgPiAyMCk6CgkJCQlpZih0aW1lKCktcmVzdGFydExpbmVUd28gPiBsaW5lVGltZVdhaXQpOgoJCQkJCXdyaXRlTGluZVR3byA9IFRydWUKCQkJCQl0b1ByaW50VGV4dExpbmVUd28gPSB0ZXh0TGluZVR3b1twb3NMaW5lVHdvOnBvc0xpbmVUd28rMjBdCgkJCQkJbGFzdFByaW50ZWRUZXh0TGluZVR3byA9IHRleHRMaW5lVHdvW3Bvc0xpbmVUd286cG9zTGluZVR3bysyMF0KCQkJCQlwb3NMaW5lVHdvID0gcG9zTGluZVR3byArIG1vdmVUZXh0CgkJCQkJbGluZVR3b0NoYW5nZWQgPSBUcnVlCgkJCQkJaWYocG9zTGluZVR3byA+PSBsZW4odGV4dExpbmVUd28pLTE4KToKCQkJCQkJcG9zTGluZVR3byA9IDEKCQkJCQkJcmVzdGFydExpbmVUd28gPSB0aW1lKCkKCQkJCQkJbGluZVR3b0NoYW5nZWQgPSBGYWxzZQoJCQkJCXRpbWVTdGFtcExpbmVUd28gPSB0aW1lKCkKCQkJZWxzZToKCQkJCXRvUHJpbnRUZXh0TGluZVR3byA9IHRleHRUd28KCQkJCXdyaXRlTGluZVR3byA9IFRydWUKCQkJCQoJCQkjIExpbmUgdGhyZWUgY29kZSBzdGFydHMgaGVyZQoJCQlpZihsZW4odGV4dFRocmVlKSA+IDIwKToKCQkJCWlmKHRpbWUoKS1yZXN0YXJ0TGluZVRocmVlID4gbGluZVRpbWVXYWl0KToKCQkJCQl3cml0ZUxpbmVUaHJlZSA9IFRydWUKCQkJCQl0b1ByaW50VGV4dExpbmVUaHJlZSA9IHRleHRMaW5lVGhyZWVbcG9zTGluZVRocmVlOnBvc0xpbmVUaHJlZSsyMF0KCQkJCQlsYXN0UHJpbnRlZFRleHRMaW5lVGhyZWUgPSB0ZXh0TGluZVRocmVlW3Bvc0xpbmVUaHJlZTpwb3NMaW5lVGhyZWUrMjBdCgkJCQkJcG9zTGluZVRocmVlID0gcG9zTGluZVRocmVlICsgbW92ZVRleHQKCQkJCQlsaW5lVGhyZWVDaGFuZ2VkID0gVHJ1ZQoJCQkJCWlmKHBvc0xpbmVUaHJlZSA+PSBsZW4odGV4dExpbmVUaHJlZSktMTgpOgoJCQkJCQlwb3NMaW5lVGhyZWUgPSAxCgkJCQkJCXJlc3RhcnRMaW5lVGhyZWUgPSB0aW1lKCkKCQkJCQkJbGluZVRocmVlQ2hhbmdlZCA9IEZhbHNlCgkJCQkJdGltZVN0YW1wTGluZVRocmVlID0gdGltZSgpCgkJCWVsc2U6CgkJCQl0b1ByaW50VGV4dExpbmVUaHJlZSA9IHRleHRUaHJlZQoJCQkJd3JpdGVMaW5lVGhyZWUgPSBUcnVlCgkJCQkKCQkJIyBMaW5lIGZvdXIgY29kZSBzdGFydHMgaGVyZQoJCQlpZihsZW4odGV4dEZvdXIpID4gMjApOgoJCQkJaWYodGltZSgpLXJlc3RhcnRMaW5lRm91ciA+IGxpbmVUaW1lV2FpdCk6CgkJCQkJd3JpdGVMaW5lRm91ciA9IFRydWUKCQkJCQl0b1ByaW50VGV4dExpbmVGb3VyID0gdGV4dExpbmVGb3VyW3Bvc0xpbmVGb3VyOnBvc0xpbmVGb3VyKzIwXQoJCQkJCWxhc3RQcmludGVkVGV4dExpbmVGb3VyID0gdGV4dExpbmVGb3VyW3Bvc0xpbmVGb3VyOnBvc0xpbmVGb3VyKzIwXQoJCQkJCXBvc0xpbmVGb3VyID0gcG9zTGluZUZvdXIgKyBtb3ZlVGV4dAoJCQkJCWxpbmVGb3VyQ2hhbmdlZCA9IFRydWUKCQkJCQlpZihwb3NMaW5lRm91ciA+PSBsZW4odGV4dExpbmVGb3VyKS0xOCk6CgkJCQkJCXBvc0xpbmVGb3VyID0gMQoJCQkJCQlyZXN0YXJ0TGluZUZvdXIgPSB0aW1lKCkKCQkJCQkJbGluZUZvdXJDaGFuZ2VkID0gRmFsc2UKCQkJCQl0aW1lU3RhbXBMaW5lRm91ciA9IHRpbWUoKQoJCQllbHNlOgoJCQkJdG9QcmludFRleHRMaW5lRm91ciA9IHRleHRGb3VyCgkJCQl3cml0ZUxpbmVGb3VyID0gVHJ1ZQoJCQkKCQkJIyBDaGVjayB3aGF0IHN0dWZmIHRvIHNlbmQgdG8gdGhlIExDRCBhbmQgd2hhdCB0byBsZWF2ZSBvdXQgYmVjYXVzZSBpdCdzIGFscmVhZHkgYmVpbmcgZGlzcGxheWVkCgkJCWlmKGxpbmVPbmVDaGFuZ2VkID09IFRydWUgYW5kIHdyaXRlTGluZU9uZSA9PSBUcnVlKToKCQkJCXNlbmRUb0xDRCgwLCB0b1ByaW50VGV4dExpbmVPbmUpCgkJCQl3cml0ZUxpbmVPbmUgPSBGYWxzZQoJCQkJbGluZU9uZUNoYW5nZWQgPSBGYWxzZQoJCQlpZihsaW5lVHdvQ2hhbmdlZCA9PSBUcnVlIGFuZCB3cml0ZUxpbmVUd28gPT0gVHJ1ZSk6CgkJCQlzZW5kVG9MQ0QoMSwgdG9QcmludFRleHRMaW5lVHdvKQoJCQkJd3JpdGVMaW5lVHdvID0gRmFsc2UKCQkJCWxpbmVUd29DaGFuZ2VkID0gRmFsc2UKCQkJaWYobGluZVRocmVlQ2hhbmdlZCA9PSBUcnVlIGFuZCB3cml0ZUxpbmVUaHJlZSA9PSBUcnVlKToKCQkJCXNlbmRUb0xDRCgyLCB0b1ByaW50VGV4dExpbmVUaHJlZSkKCQkJCXdyaXRlTGluZVRocmVlID0gRmFsc2UKCQkJCWxpbmVUaHJlZUNoYW5nZWQgPSBGYWxzZQoJCQlpZihsaW5lRm91ckNoYW5nZWQgPT0gVHJ1ZSBhbmQgd3JpdGVMaW5lRm91ciA9PSBUcnVlKToKCQkJCXNlbmRUb0xDRCgzLCB0b1ByaW50VGV4dExpbmVGb3VyKQoJCQkJd3JpdGVMaW5lRm91ciA9IEZhbHNlCgkJCQlsaW5lRm91ckNoYW5nZWQgPSBGYWxzZQoJCQl0aW1lV2FpdFRpbWVTdGFtcCA9IHRpbWUoKQpleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CglwcmludCgiXG5FeGl0aW5nLi4uIikK
sudo echo $SCROLLTEXT | sudo base64 --decode > /opt/LCDcontroller/scrollText.py

echo "Extracting Settings.py to /opt/LCDcontroller/settings.py. You can edit this file to change the boot- / welcome-message and some other settings."
echo "Execute 'sudo /etc/init.d/volumioLCDservice restart' or 'sudo reboot' to apply your settings"
SETTINGS=IyBXaGF0IHRleHQgbXVzdCB0aGUgZGlzcGxheSBzaG93IGF0IGJvb3Q/IChEZWZhdWx0OiAnV2VsY29tZSEnIG9uIHRoZSBzZWNvbmQgbGluZSkKZGVmIGdldFdlbGNvbWVNZXNzYWdlKCk6CiAgICAgICAgd2VsY29tZV9tZXNzYWdlID0gewogICAgICAgICAgICAgICAgIkxpbmUxIjogIiAiLAogICAgICAgICAgICAgICAgIkxpbmUyIjogIldlbGNvbWUhIiwKICAgICAgICAgICAgICAgICJMaW5lMyI6ICIgIiwKICAgICAgICAgICAgICAgICJMaW5lNCI6ICIgIgogICAgICAgICAgICAgICAgfQogICAgICAgIHJldHVybiB3ZWxjb21lX21lc3NhZ2UKIyBIb3cgbG9uZyBzaG91bGQgdGhlIHdlbGNvbWUtbWVzc2FnZSBzdGF5PwpkZWYgZ2V0V2VsY29tZU1lc3NhZ2VEdXJhdGlvbigpOgogICAgICAgIHdlbGNvbWVNZXNzYWdlRHVyYXRpb24gPSAyCiAgICAgICAgcmV0dXJuIHdlbGNvbWVNZXNzYWdlRHVyYXRpb24KCiMgSG93IG9mdGVuIHNob3VsZCB0aGUgc2NyaXB0IGNoZWNrIGZvciBuZXcgc29uZy93ZWJyYWRpbyBpbmZvPwpkZWYgZ2V0SW5mb1JlZnJlc2hJbnRlcnZhbCgpOgogICAgICAgIGluZm9SZWZyZXNoSW50ZXJ2YWwgPSAwLjUKICAgICAgICByZXR1cm4gaW5mb1JlZnJlc2hJbnRlcnZhbAogICAgICAgIAojIFdoZXJlIHNob3VsZCB0aGUgc2NyaXB0IGdldCBpdCdzIGluZm9ybWF0aW9uIGZyb20/CmRlZiBnZXRIb3N0SVAoKToKCXZvbHVtaW9Ib3N0ID0gJzEyNy4wLjAuMScgICMgVGhpcyBjYW4gYmUgYW4gSVAgYWRkcmVzcyBvciAnbG9jYWxob3N0JwoJcmV0dXJuIHZvbHVtaW9Ib3N0Cg==
sudo echo $SETTINGS | sudo base64 --decode > /opt/LCDcontroller/settings.py

echo "Extracting Dependencies"
# Store i2c_lib.py
ICLIBPY=aW1wb3J0IHNtYnVzCmZyb20gdGltZSBpbXBvcnQgKgoKY2xhc3MgaTJjX2RldmljZToKICBkZWYgX19pbml0X18oc2VsZiwgYWRkciwgcG9ydD0wKToKICAgIHNlbGYuYWRkciA9IGFkZHIKICAgIHNlbGYuYnVzID0gc21idXMuU01CdXMocG9ydCkKCiAgIyBXcml0ZSBhIHNpbmdsZSBjb21tYW5kCiAgZGVmIHdyaXRlX2NtZChzZWxmLCBjbWQpOgogICAgc2VsZi5idXMud3JpdGVfYnl0ZShzZWxmLmFkZHIsIGNtZCkKICAgIHNsZWVwKDAuMDAwMSkKCiAgIyBXcml0ZSBhIGNvbW1hbmQgYW5kIGFyZ3VtZW50CiAgZGVmIHdyaXRlX2NtZF9hcmcoc2VsZiwgY21kLCBkYXRhKToKICAgIHNlbGYuYnVzLndyaXRlX2J5dGVfZGF0YShzZWxmLmFkZHIsIGNtZCwgZGF0YSkKICAgIHNsZWVwKDAuMDAwMSkKCiAgIyBXcml0ZSBhIGJsb2NrIG9mIGRhdGEKICBkZWYgd3JpdGVfYmxvY2tfZGF0YShzZWxmLCBjbWQsIGRhdGEpOgogICAgc2VsZi5idXMud3JpdGVfYmxvY2tfZGF0YShzZWxmLmFkZHIsIGNtZCwgZGF0YSkKICAgIHNsZWVwKDAuMDAwMSkKCiAgIyBSZWFkIGEgc2luZ2xlIGJ5dGUKICBkZWYgcmVhZChzZWxmKToKICAgIHJldHVybiBzZWxmLmJ1cy5yZWFkX2J5dGUoc2VsZi5hZGRyKQoKICAjIFJlYWQKICBkZWYgcmVhZF9kYXRhKHNlbGYsIGNtZCk6CiAgICByZXR1cm4gc2VsZi5idXMucmVhZF9ieXRlX2RhdGEoc2VsZi5hZGRyLCBjbWQpCgogICMgUmVhZCBhIGJsb2NrIG9mIGRhdGEKICBkZWYgcmVhZF9ibG9ja19kYXRhKHNlbGYsIGNtZCk6CiAgICByZXR1cm4gc2VsZi5idXMucmVhZF9ibG9ja19kYXRhKHNlbGYuYWRkciwgY21kKQoK
sudo echo $ICLIBPY | sudo base64 --decode > /opt/LCDcontroller/i2c_lib.py

# Store i2c_lib.pyc
ICLIBPYC=A/MNCsvtYlhjAAAAAAAAAAADAAAAQAAAAHMtAAAAZAAAZAEAbAAAWgAAZAAAZAIAbAEAVGQDAGQFAGQEAIQAAIMAAFlaAgBkAQBTKAYAAABp/////04oAQAAAHQBAAAAKnQKAAAAaTJjX2RldmljZWMAAAAAAAAAAAIAAABCAAAAc0oAAABlAABaAQBkAABkAQCEAQBaAgBkAgCEAABaAwBkAwCEAABaBABkBACEAABaBQBkBQCEAABaBgBkBgCEAABaBwBkBwCEAABaCABSUygIAAAAaQAAAABjAwAAAAMAAAACAAAAQwAAAHMfAAAAfAEAfAAAXwAAdAEAagIAfAIAgwEAfAAAXwMAZAAAUygBAAAATigEAAAAdAQAAABhZGRydAUAAABzbWJ1c3QFAAAAU01CdXN0AwAAAGJ1cygDAAAAdAQAAABzZWxmUgIAAAB0BAAAAHBvcnQoAAAAACgAAAAAczYAAAAvaG9tZS92b2x1bWlvLzR4MjBMQ0QvcmFzcGktZ3Bpby90ZXN0bWFwamVuL2kyY19saWIucHl0CAAAAF9faW5pdF9fBQAAAHMEAAAAAAEJAWMCAAAAAgAAAAMAAABDAAAAcyQAAAB8AABqAABqAQB8AABqAgB8AQCDAgABdAMAZAEAgwEAAWQAAFMoAgAAAE5nLUMc6+I2Gj8oBAAAAFIFAAAAdAoAAAB3cml0ZV9ieXRlUgIAAAB0BQAAAHNsZWVwKAIAAABSBgAAAHQDAAAAY21kKAAAAAAoAAAAAHM2AAAAL2hvbWUvdm9sdW1pby80eDIwTENEL3Jhc3BpLWdwaW8vdGVzdG1hcGplbi9pMmNfbGliLnB5dAkAAAB3cml0ZV9jbWQKAAAAcwQAAAAAARYBYwMAAAADAAAABAAAAEMAAABzJwAAAHwAAGoAAGoBAHwAAGoCAHwBAHwCAIMDAAF0AwBkAQCDAQABZAAAUygCAAAATmctQxzr4jYaPygEAAAAUgUAAAB0DwAAAHdyaXRlX2J5dGVfZGF0YVICAAAAUgoAAAAoAwAAAFIGAAAAUgsAAAB0BAAAAGRhdGEoAAAAACgAAAAAczYAAAAvaG9tZS92b2x1bWlvLzR4MjBMQ0QvcmFzcGktZ3Bpby90ZXN0bWFwamVuL2kyY19saWIucHl0DQAAAHdyaXRlX2NtZF9hcmcPAAAAcwQAAAAAARkBYwMAAAADAAAABAAAAEMAAABzJwAAAHwAAGoAAGoBAHwAAGoCAHwBAHwCAIMDAAF0AwBkAQCDAQABZAAAUygCAAAATmctQxzr4jYaPygEAAAAUgUAAAB0EAAAAHdyaXRlX2Jsb2NrX2RhdGFSAgAAAFIKAAAAKAMAAABSBgAAAFILAAAAUg4AAAAoAAAAACgAAAAAczYAAAAvaG9tZS92b2x1bWlvLzR4MjBMQ0QvcmFzcGktZ3Bpby90ZXN0bWFwamVuL2kyY19saWIucHlSEAAAABQAAABzBAAAAAABGQFjAQAAAAEAAAACAAAAQwAAAHMTAAAAfAAAagAAagEAfAAAagIAgwEAUygBAAAATigDAAAAUgUAAAB0CQAAAHJlYWRfYnl0ZVICAAAAKAEAAABSBgAAACgAAAAAKAAAAABzNgAAAC9ob21lL3ZvbHVtaW8vNHgyMExDRC9yYXNwaS1ncGlvL3Rlc3RtYXBqZW4vaTJjX2xpYi5weXQEAAAAcmVhZBkAAABzAgAAAAABYwIAAAACAAAAAwAAAEMAAABzFgAAAHwAAGoAAGoBAHwAAGoCAHwBAIMCAFMoAQAAAE4oAwAAAFIFAAAAdA4AAAByZWFkX2J5dGVfZGF0YVICAAAAKAIAAABSBgAAAFILAAAAKAAAAAAoAAAAAHM2AAAAL2hvbWUvdm9sdW1pby80eDIwTENEL3Jhc3BpLWdwaW8vdGVzdG1hcGplbi9pMmNfbGliLnB5dAkAAAByZWFkX2RhdGEdAAAAcwIAAAAAAWMCAAAAAgAAAAMAAABDAAAAcxYAAAB8AABqAABqAQB8AABqAgB8AQCDAgBTKAEAAABOKAMAAABSBQAAAHQPAAAAcmVhZF9ibG9ja19kYXRhUgIAAAAoAgAAAFIGAAAAUgsAAAAoAAAAACgAAAAAczYAAAAvaG9tZS92b2x1bWlvLzR4MjBMQ0QvcmFzcGktZ3Bpby90ZXN0bWFwamVuL2kyY19saWIucHlSFQAAACEAAABzAgAAAAABKAkAAAB0CAAAAF9fbmFtZV9fdAoAAABfX21vZHVsZV9fUggAAABSDAAAAFIPAAAAUhAAAABSEgAAAFIUAAAAUhUAAAAoAAAAACgAAAAAKAAAAABzNgAAAC9ob21lL3ZvbHVtaW8vNHgyMExDRC9yYXNwaS1ncGlvL3Rlc3RtYXBqZW4vaTJjX2xpYi5weVIBAAAABAAAAHMOAAAABgEMBQkFCQUJBQkECQQoAAAAACgDAAAAUgMAAAB0BAAAAHRpbWVSAQAAACgAAAAAKAAAAAAoAAAAAHM2AAAAL2hvbWUvdm9sdW1pby80eDIwTENEL3Jhc3BpLWdwaW8vdGVzdG1hcGplbi9pMmNfbGliLnB5dAgAAAA8bW9kdWxlPgEAAABzBAAAAAwBCgI=
sudo echo $ICLIBPYC | sudo base64 --decode > /opt/LCDcontroller/i2c_lib.pyc

# Store lcd_display.py
LCDDISPLAYPY=aW1wb3J0IGkyY19saWIKZnJvbSB0aW1lIGltcG9ydCBzbGVlcAoKIyBMQ0QgQWRkcmVzcwpBRERSRVNTID0gMHgzRgoKIyBjb21tYW5kcwpMQ0RfQ0xFQVJESVNQTEFZID0gMHgwMQpMQ0RfUkVUVVJOSE9NRSA9IDB4MDIKTENEX0VOVFJZTU9ERVNFVCA9IDB4MDQKTENEX0RJU1BMQVlDT05UUk9MID0gMHgwOApMQ0RfQ1VSU09SU0hJRlQgPSAweDEwCkxDRF9GVU5DVElPTlNFVCA9IDB4MjAKTENEX1NFVENHUkFNQUREUiA9IDB4NDAKTENEX1NFVEREUkFNQUREUiA9IDB4ODAKCiMgZmxhZ3MgZm9yIGRpc3BsYXkgZW50cnkgbW9kZQpMQ0RfRU5UUllSSUdIVCA9IDB4MDAKTENEX0VOVFJZTEVGVCA9IDB4MDIKTENEX0VOVFJZU0hJRlRJTkNSRU1FTlQgPSAweDAxCkxDRF9FTlRSWVNISUZUREVDUkVNRU5UID0gMHgwMAoKIyBmbGFncyBmb3IgZGlzcGxheSBvbi9vZmYgY29udHJvbApMQ0RfRElTUExBWU9OID0gMHgwNApMQ0RfRElTUExBWU9GRiA9IDB4MDAKTENEX0NVUlNPUk9OID0gMHgwMgpMQ0RfQ1VSU09ST0ZGID0gMHgwMApMQ0RfQkxJTktPTiA9IDB4MDEKTENEX0JMSU5LT0ZGID0gMHgwMAoKIyBmbGFncyBmb3IgZGlzcGxheS9jdXJzb3Igc2hpZnQKTENEX0RJU1BMQVlNT1ZFID0gMHgwOApMQ0RfQ1VSU09STU9WRSA9IDB4MDAKTENEX01PVkVSSUdIVCA9IDB4MDQKTENEX01PVkVMRUZUID0gMHgwMAoKIyBmbGFncyBmb3IgZnVuY3Rpb24gc2V0CkxDRF84QklUTU9ERSA9IDB4MTAKTENEXzRCSVRNT0RFID0gMHgwMApMQ0RfMkxJTkUgPSAweDA4CkxDRF8xTElORSA9IDB4MDAKTENEXzV4MTBET1RTID0gMHgwNApMQ0RfNXg4RE9UUyA9IDB4MDAKCiMgZmxhZ3MgZm9yIGJhY2tsaWdodCBjb250cm9sCkxDRF9CQUNLTElHSFQgPSAweDA4CkxDRF9OT0JBQ0tMSUdIVCA9IDB4MDAKCkVuID0gMGIwMDAwMDEwMCAjIEVuYWJsZSBiaXQKUncgPSAwYjAwMDAwMDEwICMgUmVhZC9Xcml0ZSBiaXQKUnMgPSAwYjAwMDAwMDAxICMgUmVnaXN0ZXIgc2VsZWN0IGJpdAoKY2xhc3MgbGNkOgogICIiIiAKICBDbGFzcyB0byBjb250cm9sIHRoZSAxNngyIEkyQyBMQ0QgZGlzcGxheSBmcm9tIHNhaW5zbWFydCBmcm9tIHRoZSBSYXNwYmVycnkgUGkKICAiIiIKCiAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgIiIiU2V0dXAgdGhlIGRpc3BsYXksIHR1cm4gb24gYmFja2xpZ2h0IGFuZCB0ZXh0IGRpc3BsYXkgKyAuLi4/IiIiCiAgICBzZWxmLmRldmljZSA9IGkyY19saWIuaTJjX2RldmljZShBRERSRVNTLDEpCgogICAgc2VsZi53cml0ZSgweDAzKQogICAgc2VsZi53cml0ZSgweDAzKQogICAgc2VsZi53cml0ZSgweDAzKQogICAgc2VsZi53cml0ZSgweDAyKQoKICAgIHNlbGYud3JpdGUoTENEX0ZVTkNUSU9OU0VUIHwgTENEXzJMSU5FIHwgTENEXzV4OERPVFMgfCBMQ0RfNEJJVE1PREUpCiAgICBzZWxmLndyaXRlKExDRF9ESVNQTEFZQ09OVFJPTCB8IExDRF9ESVNQTEFZT04pCiAgICBzZWxmLndyaXRlKExDRF9DTEVBUkRJU1BMQVkpCiAgICBzZWxmLndyaXRlKExDRF9FTlRSWU1PREVTRVQgfCBMQ0RfRU5UUllMRUZUKQogICAgc2xlZXAoMC4yKQoKICBkZWYgc3Ryb2JlKHNlbGYsIGRhdGEpOgogICAgIiIiY2xvY2tzIEVOIHRvIGxhdGNoIGNvbW1hbmQiIiIKICAgIHNlbGYuZGV2aWNlLndyaXRlX2NtZChkYXRhIHwgRW4gfCBMQ0RfQkFDS0xJR0hUKQogICAgc2xlZXAoMC4wMDA1KQogICAgc2VsZi5kZXZpY2Uud3JpdGVfY21kKCgoZGF0YSAmIH5FbikgfCBMQ0RfQkFDS0xJR0hUKSkKICAgIHNsZWVwKDAuMDAxKQoKICBkZWYgd3JpdGVfZm91cl9iaXRzKHNlbGYsIGRhdGEpOgogICAgc2VsZi5kZXZpY2Uud3JpdGVfY21kKGRhdGEgfCBMQ0RfQkFDS0xJR0hUKQogICAgc2VsZi5zdHJvYmUoZGF0YSkKCiAgZGVmIHdyaXRlKHNlbGYsIGNtZCwgbW9kZT0wKToKICAgICIiIndyaXRlIGEgY29tbWFuZCB0byBsY2QiIiIKICAgIHNlbGYud3JpdGVfZm91cl9iaXRzKG1vZGUgfCAoY21kICYgMHhGMCkpCiAgICBzZWxmLndyaXRlX2ZvdXJfYml0cyhtb2RlIHwgKChjbWQgPDwgNCkgJiAweEYwKSkKCiMgIGRlZiBkaXNwbGF5X3N0cmluZyhzZWxmLCBzdHJpbmcsIGxpbmUpOgogIGRlZiBkaXNwbGF5X3N0cmluZyhzZWxmLCBzdHJpbmcsIGxpbmUpOgogICAgIiIiZGlzcGxheSBhIHN0cmluZyBvbiB0aGUgZ2l2ZW4gbGluZSBvZiB0aGUgZGlzcGxheSwgMSBvciAyLCBzdHJpbmcgaXMgdHJ1bmNhdGVkIHRvIDIwIGNoYXJzIGFuZCBjZW50cmVkIiIiCiAgICBjZW50ZXJlZF9zdHJpbmcgPSBzdHJpbmcuY2VudGVyKDIwKQogICAgaWYgbGluZSA9PSAxOgogICAgICBzZWxmLndyaXRlKDB4ODApCiAgICBpZiBsaW5lID09IDI6CiAgICAgIHNlbGYud3JpdGUoMHg5NCkKICAgIGlmIGxpbmUgPT0gMzoKICAgICAgc2VsZi53cml0ZSgweEMwKQogICAgaWYgbGluZSA9PSA0OgogICAgICBzZWxmLndyaXRlKDB4RDQpIAogICAgZm9yIGNoYXIgaW4gY2VudGVyZWRfc3RyaW5nOgogICAgICBzZWxmLndyaXRlKG9yZChjaGFyKSwgUnMpCgogIGRlZiBjbGVhcihzZWxmKToKICAgICIiImNsZWFyIGxjZCBhbmQgc2V0IHRvIGhvbWUiIiIKICAgIHNlbGYud3JpdGUoTENEX0NMRUFSRElTUExBWSkKICAgIHNlbGYud3JpdGUoTENEX1JFVFVSTkhPTUUpCgogIGRlZiBiYWNrbGlnaHRfb2ZmKHNlbGYpOgogICAgIiIidHVybiBvZmYgYmFja2xpZ2h0LCBhbnl0aGluZyB0aGF0IGNhbGxzIHdyaXRlIHR1cm5zIGl0IG9uIGFnYWluIiIiCiAgICBzZWxmLmRldmljZS53cml0ZV9jbWQoTENEX05PQkFDS0xJR0hUKQoKICBkZWYgZGlzcGxheV9vZmYoc2VsZik6CiAgICAiIiJ0dXJuIG9mZiB0aGUgdGV4dCBkaXNwbGF5IiIiCiAgICBzZWxmLndyaXRlKExDRF9ESVNQTEFZQ09OVFJPTCB8IExDRF9ESVNQTEFZT0ZGKQoKICBkZWYgZGlzcGxheV9vbihzZWxmKToKICAgICIiInR1cm4gb24gdGhlIHRleHQgZGlzcGxheSIiIgogICAgc2VsZi53cml0ZShMQ0RfRElTUExBWUNPTlRST0wgfCBMQ0RfRElTUExBWU9OKQo=
sudo echo $LCDDISPLAYPY | sudo base64 --decode > /opt/LCDcontroller/lcd_display.py

# Store lcd_display.pyc
LCDDISPLAYPYC=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AAAAAHM6AAAAL2hvbWUvdm9sdW1pby80eDIwTENEL3Jhc3BpLWdwaW8vdGVzdG1hcGplbi9sY2RfZGlzcGxheS5weVIBAAAANQAAAHMUAAAABgMGAgkPCQcJBAwGCQ4JBQkECQQoAAAAACgmAAAAUgIAAAB0BAAAAHRpbWVSAAAAAFIEAAAAUg0AAABSIgAAAFIOAAAAUgsAAAB0DwAAAExDRF9DVVJTT1JTSElGVFIHAAAAdBAAAABMQ0RfU0VUQ0dSQU1BRERSdBAAAABMQ0RfU0VURERSQU1BRERSdA4AAABMQ0RfRU5UUllSSUdIVFIPAAAAdBcAAABMQ0RfRU5UUllTSElGVElOQ1JFTUVOVHQXAAAATENEX0VOVFJZU0hJRlRERUNSRU1FTlRSDAAAAFImAAAAdAwAAABMQ0RfQ1VSU09ST050DQAAAExDRF9DVVJTT1JPRkZ0CwAAAExDRF9CTElOS09OdAwAAABMQ0RfQkxJTktPRkZ0DwAAAExDRF9ESVNQTEFZTU9WRXQOAAAATENEX0NVUlNPUk1PVkV0DQAAAExDRF9NT1ZFUklHSFR0DAAAAExDRF9NT1ZFTEVGVHQMAAAATENEXzhCSVRNT0RFUgoAAABSCAAAAHQJAAAATENEXzFMSU5FdAwAAABMQ0RfNXgxMERPVFNSCQAAAFIUAAAAUiQAAABSEwAAAHQCAAAAUndSHAAAAFIBAAAAKAAAAAAoAAAAACgAAAAAczoAAAAvaG9tZS92b2x1bWlvLzR4MjBMQ0QvcmFzcGktZ3Bpby90ZXN0bWFwamVuL2xjZF9kaXNwbGF5LnB5dAgAAAA8bW9kdWxlPgEAAABzSAAAAAwBEAMGAwYBBgEGAQYBBgEGAQYBBgMGAQYBBgEGAwYBBgEGAQYBBgEGAwYBBgEGAQYDBgEGAQYBBgEGAQYDBgEGAgYBBgEGAg==
sudo echo $LCDDISPLAYPYC | sudo base64 --decode > /opt/LCDcontroller/lcd_display.pyc

echo "Extracting Startup Script"
# Store volumioLCDservice in /etc/init.d/
SERVICEFILE=IyEgL2Jpbi9zaAojIC9ldGMvaW5pdC5kL3ZvbHVtaW9MQ0RzZXJ2aWNlCiMKCiMgU29tZSB0aGluZ3MgdGhhdCBydW4gYWx3YXlzCnRvdWNoIC92YXIvbG9jay92b2x1bWlvTENEc2VydmljZQoKIyBDYXJyeSBvdXQgc3BlY2lmaWMgZnVuY3Rpb25zIHdoZW4gYXNrZWQgdG8gYnkgdGhlIHN5c3RlbQpjYXNlICIkMSIgaW4KICBzdGFydCkKICAgIHN1ZG8gcHl0aG9uIC9vcHQvTENEY29udHJvbGxlci9zY3JvbGxUZXh0LnB5ICYKICAgIDs7CiAgc3RvcCkKICAgIGVjaG8gIlN0b3BwaW5nIExDRC1jb250cm9sbGVyICIKICAgIHN1ZG8ga2lsbGFsbCBweXRob24KICAgIDs7CiAgcmVzdGFydCkKICAgIGVjaG8gIlJlc3RhcnRpbmcgTENELWNvbnRyb2xsZXIiCiAgICBzdWRvIGtpbGxhbGwgcHl0aG9uCiAgICBzdWRvIHB5dGhvbiAvb3B0L0xDRGNvbnRyb2xsZXIvc2Nyb2xsVGV4dC5weSAmCiAgICA7OwogICopCiAgICBlY2hvICJVc2FnZTogL2V0Yy9pbml0LmQvdm9sdW1pb0xDRHNlcnZpY2Uge3N0YXJ0fHN0b3B9IgogICAgZXhpdCAxCiAgICA7Owplc2FjCgpleGl0IDAK
sudo echo $SERVICEFILE | sudo base64 --decode > /etc/init.d/volumioLCDservice
echo "Registering Startup Script"
sudo chmod +x /etc/init.d/volumioLCDservice
sudo update-rc.d volumioLCDservice defaults

echo " "
echo "LCD controller installed! Please reboot to start it or run 'sudo /etc/init.d/volumioLCDservice start' from a remote shell"

# Plugin installed!
echo "plugininstallend"
